\section{Application to Fiasco}

\subsection{Configuration of \& modifications to Fiasco}

\paragraph{Configuration}

\tobewritten{fill}

\paragraph{\texttt{regparm} and \texttt{nonnull} attributes}

\tobewritten{fill}

\paragraph{GNU89 vs C99 inlining}

\tobewritten{fill}

\paragraph{Variable-length arrays}

\tobewritten{fill}

\paragraph{Inline Assembly}

LLVM's integrated assembler led to problems in several areas and was later
deactivated. The following section lists modifications that were initially
attempted to allow its use.

Fiasco uses the \emph{sub-sections} feature specific to the GNU
assembler~\cite{gas-subsections} in \texttt{/boot\-/ia32\-/boot\_idt.S}, which
is currently not supported by LLVM. The offending parts were changed to normal
section statements as recommended by \todo{mentions like this OK?}Adam
Lackorzy≈Ñski, which led to new errors upon booting.

The documentation on Clang's compatibility with current language standards and
popular compiler extensions~\cite[Inline assembly]{clang-compatibility}
explains why the integrated assembler does not accept ambiguous x86
instructions whose sizes can't be inferred from their operands; their handling
by the GNU assembler is considered a bug. Instructions with the appropriate
suffix were used where applicable.

There were \todo{elaborate}further problems concerning macro expansion in
\texttt{/kern/ia32/32\-/en\-try.S} and \texttt{/kern/ia32/32\-/entry-native.S}.

The use of the integrated assembler was then discontinued via the
\texttt{-no-integrated-as} option~\cite{manclang} in favour of the GNU
assembler with which the problematic parts of Fiasco are known to work.
All modifications made to this point were reverted.
